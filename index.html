<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Matrix Calculator (Cramer's Rule)</title>
    <style>
        /* Define color variables for light mode */
        :root {
            --bg-color: #f0f4f8;
            --text-color: #2d3748;
            --input-bg: #ffffff;
            --input-border: #cbd5e0;
            --button-bg: #4299e1;
            --button-text: #ffffff;
            --card-bg: #ffffff;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --error-color: #e53e3e;
            --success-color: #38a169;
        }

        /* Define color variables for dark mode */
        .dark-mode {
            --bg-color: #1a202c;
            --text-color: #e2e8f0;
            --input-bg: #2d3748;
            --input-border: #4a5568;
            --button-bg: #4299e1;
            --button-text: #ffffff;
            --card-bg: #2d3748;
            --card-shadow: 0 4px 6px rgba(255, 255, 255, 0.1);
            --error-color: #fc8181;
            --success-color: #68d391;
        }

        /* Set up the body styles and background pattern */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
            background-image: 
                linear-gradient(30deg, var(--card-bg) 12%, transparent 12.5%, transparent 87%, var(--card-bg) 87.5%, var(--card-bg)),
                linear-gradient(150deg, var(--card-bg) 12%, transparent 12.5%, transparent 87%, var(--card-bg) 87.5%, var(--card-bg)),
                linear-gradient(30deg, var(--card-bg) 12%, transparent 12.5%, transparent 87%, var(--card-bg) 87.5%, var(--card-bg)),
                linear-gradient(150deg, var(--card-bg) 12%, transparent 12.5%, transparent 87%, var(--card-bg) 87.5%, var(--card-bg)),
                linear-gradient(60deg, var(--input-border) 25%, transparent 25.5%, transparent 75%, var(--input-border) 75%, var(--input-border)),
                linear-gradient(60deg, var(--input-border) 25%, transparent 25.5%, transparent 75%, var(--input-border) 75%, var(--input-border));
            background-size: 80px 140px;
            background-position: 0 0, 0 0, 40px 70px, 40px 70px, 0 0, 40px 70px;
        }

        /* Style the main container */
        .container {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            width: 100%;
            max-width: 700px;
        }

        /* Style headings */
        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        /* Add margin to matrix size and action sections */
        .matrix-size, .matrix-actions {
            margin-bottom: 20px;
        }

        /* Style select and text input elements */
        select, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            margin-bottom: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        /* Style focus state for select and text input elements */
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--button-bg);
        }

        /* Style the matrix input container */
        .matrix-inputs {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Style each row of the matrix */
        .matrix-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        /* Style number input elements */
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        /* Style focus state for number input elements */
        input[type="number"]:focus {
            outline: none;
            border-color: var(--button-bg);
        }

        /* Style buttons */
        button {
            width: 100%;
            padding: 12px;
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
            transition: background-color 0.3s;
        }

        /* Style button hover state */
        button:hover {
            opacity: 0.9;
        }

        /* Style the button group container */
        .button-group {
            display: flex;
            gap: 10px;
        }

        /* Style result, step-by-step, and determinants sections */
        #result, #step-by-step, #determinants {
            margin-top: 20px;
            background-color: var(--input-bg);
            border-radius: 6px;
            padding: 15px;
        }

        /* Style message elements */
        .message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        /* Style error messages */
        .error {
            background-color: var(--error-color);
            color: #ffffff;
        }

        /* Style success messages */
        .success {
            background-color: var(--success-color);
            color: #ffffff;
        }

        /* Style the dark mode toggle button */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
        }

        /* Style each step in the step-by-step solution */
        .step {
            margin-bottom: 15px;
            border-left: 3px solid var(--button-bg);
            padding-left: 15px;
        }

        /* Media query for responsive design on smaller screens */
        @media (max-width: 600px) {
            .matrix-row {
                grid-template-columns: repeat(3, 1fr);
            }
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Dark mode toggle button -->
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">ðŸŒ“</button>
    <div class="container">
        <h1>Advanced Matrix Calculator (Cramer's Rule)</h1>
        <!-- Matrix size selection dropdown -->
        <div class="matrix-size">
            <select id="matrix-size" onchange="updateMatrixInputs()">
                <option value="2">2x2 Matrix</option>
                <option value="3">3x3 Matrix</option>
                <option value="4" selected>4x4 Matrix</option>
            </select>
        </div>
        <!-- Container for matrix input fields -->
        <div id="matrix-inputs" class="matrix-inputs"></div>
        <div class="matrix-actions">
            <!-- Button group for main actions -->
            <div class="button-group">
                <button onclick="getDeterminants()">Get Determinants</button>
                <button onclick="solve()">Solve</button>
                <button onclick="generateRandomInputs()">Random Inputs</button>
            </div>
            <!-- Matrix save and load functionality -->
            <button onclick="saveMatrix()">Save Matrix</button>
            <input type="text" id="load-matrix-name" placeholder="Enter matrix name to load">
            <button onclick="loadMatrix()">Load Matrix</button>
        </div>
        <!-- Container for displaying messages -->
        <div id="message" class="message" style="display: none;"></div>
        <!-- Containers for displaying results -->
        <div id="determinants"></div>
        <div id="result"></div>
        <div id="step-by-step"></div>
    </div>

    <script>
        // Function to update matrix input fields based on selected size
        function updateMatrixInputs() {
            const size = parseInt(document.getElementById('matrix-size').value); // Get selected matrix size
            const matrixInputs = document.getElementById('matrix-inputs'); // Get container for matrix inputs
            matrixInputs.innerHTML = ''; // Clear existing inputs

            // Create input fields for the matrix
            for (let i = 0; i < size; i++) {
                const row = document.createElement('div'); // Create a new row
                row.className = 'matrix-row'; // Add class to the row
                for (let j = 0; j < size + 1; j++) {
                    const input = document.createElement('input'); // Create an input field
                    input.type = 'number'; // Set input type to number
                    input.value = '0'; // Set default value
                    input.step = 'any'; // Allow any number (including decimals)
                    input.setAttribute('aria-label', `Row ${i + 1}, Column ${j + 1}`); // Add aria-label for accessibility
                    row.appendChild(input); // Add input to the row
                }
                matrixInputs.appendChild(row); // Add row to the matrix inputs container
            }
        }

        // Function to get the current matrix values
        function getMatrix() {
            const size = parseInt(document.getElementById('matrix-size').value); // Get selected matrix size
            const matrix = []; // Initialize empty matrix
            const inputs = document.querySelectorAll('#matrix-inputs input'); // Get all input fields

            // Populate the matrix with input values
            for (let i = 0; i < size; i++) {
                const row = []; // Initialize a new row
                for (let j = 0; j < size + 1; j++) {
                    row.push(parseFloat(inputs[i * (size + 1) + j].value) || 0); // Add value to row, default to 0 if empty
                }
                matrix.push(row); // Add row to matrix
            }

            return matrix; // Return the complete matrix
        }

        // Function to calculate the determinant of a matrix
        function determinant(matrix) {
            const n = matrix.length; // Get matrix size
            if (n === 1) return matrix[0][0]; // Base case: 1x1 matrix
            if (n === 2) return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0]; // Base case: 2x2 matrix

            let det = 0; // Initialize determinant
            for (let j = 0; j < n; j++) {
                // Create submatrix by removing first row and current column
                const subMatrix = matrix.slice(1).map(row => [...row.slice(0, j), ...row.slice(j + 1)]);
                det += Math.pow(-1, j) * matrix[0][j] * determinant(subMatrix); // Recursive call for submatrix
            }
            return det; // Return calculated determinant
        }

        // Function to validate user inputs
        function validateInputs() {
            const inputs = document.querySelectorAll('#matrix-inputs input'); // Get all input fields
            for (let input of inputs) {
                if (input.value.trim() === '') { // Check if any input is empty
                    showMessage('Please fill in all fields.', 'error'); // Show error message
                    return false; // Validation failed
                }
            }
            return true; // All inputs are valid
        }

        // Function to calculate and display determinants
        function getDeterminants() {
            if (!validateInputs()) return; // Validate inputs before proceeding

            const matrix = getMatrix(); // Get current matrix
            const n = matrix.length; // Get matrix size
            const coefficients = matrix.map(row => row.slice(0, -1)); // Get coefficient matrix
            const mainDet = determinant(coefficients); // Calculate main determinant

            let determinantsHtml = '<h2>Determinants</h2>'; // Start building HTML for determinants
            determinantsHtml += `<p><strong>Main Determinant:</strong> ${mainDet.toFixed(4)}</p>`; // Add main determinant

            // Calculate and add determinants for each variable
            for (let i = 0; i < n; i++) {
                const modifiedMatrix = matrix.map(row => [...row.slice(0, i), row[n], ...row.slice(i + 1, n)]);
                const det = determinant(modifiedMatrix);
                determinantsHtml += `<p><strong>Det(A${i + 1}):</strong> ${det.toFixed(4)}</p>`;
            }

            document.getElementById('determinants').innerHTML = determinantsHtml; // Display determinants
        }

        // Function to solve the matrix using Cramer's rule
        function solve() {
            if (!validateInputs()) return; // Validate inputs before proceeding

            const matrix = getMatrix(); // Get current matrix
            const n = matrix.length; // Get matrix size
            const mainDet = determinant(matrix.map(row => row.slice(0, -1))); // Calculate main determinant

            let stepByStep = '<h2>Step-by-Step Solution</h2>'; // Start building step-by-step solution HTML

            stepByStep += `<div class="step"><strong>Step 1:</strong> Calculate the determinant of the coefficient matrix.<br>Det(A) = ${mainDet.toFixed(4)}</div>`;

            if (mainDet === 0) { // Check if the system has no unique solution
                document.getElementById('result').innerHTML = '<strong>Result:</strong> The system has no unique solution.';
                document.getElementById('step-by-step').innerHTML = stepByStep;
                return;
            }

            

            const solutions = []; // Initialize array for solutions
            for (let i = 0; i < n; i++) {
                // Create modified matrix for each variable
                const modifiedMatrix = matrix.map(row => [...row.slice(0, i), row[n], ...row.slice(i + 1, n)]);
                const det = determinant(modifiedMatrix); // Calculate determinant of modified matrix
                solutions.push(det / mainDet); // Calculate and store solution

                // Add step to the step-by-step solution
                stepByStep += `<div class="step"><strong>Step ${i + 2}:</strong> Calculate Det(A${i + 1}) and x${i + 1}.<br>`;
                stepByStep += `Det(A${i + 1}) = ${det.toFixed(4)}<br>`;
                stepByStep += `x${i + 1} = Det(A${i + 1}) / Det(A) = ${solutions[i].toFixed(4)}</div>`;
            }

            // Display results and step-by-step solution
            document.getElementById('result').innerHTML = '<strong>Result:</strong><br>' + solutions.map((sol, i) => `x${i + 1} = ${sol.toFixed(4)}`).join('<br>');
            document.getElementById('step-by-step').innerHTML = stepByStep;
        }

        // Function to generate random inputs for the matrix
        function generateRandomInputs() {
            const size = parseInt(document.getElementById('matrix-size').value); // Get selected matrix size
            const inputs = document.querySelectorAll('#matrix-inputs input'); // Get all input fields
            inputs.forEach(input => {
                input.value = (Math.random() * 20 - 10).toFixed(2); // Set random value between -10 and 10
            });
        }

        // Function to save the current matrix
        function saveMatrix() {
            const matrix = getMatrix(); // Get current matrix
            const size = matrix.length; // Get matrix size
            const name = prompt("Enter a name for this matrix:"); // Prompt user for matrix name
            if (name) {
                try {
                    localStorage.setItem(name, JSON.stringify({size, matrix})); // Save matrix to localStorage
                    showMessage(`Matrix "${name}" saved successfully.`, 'success'); // Show success message
                } catch (e) {
                    showMessage('Failed to save matrix. Storage might be full.', 'error'); // Show error message if save fails
                }
            }
        }

        // Function to load a saved matrix
        function loadMatrix() {
            const name = document.getElementById('load-matrix-name').value; // Get matrix name to load
            const saved = localStorage.getItem(name); // Retrieve saved matrix from localStorage
            if (saved) {
                try {
                    const {size, matrix} = JSON.parse(saved); // Parse saved matrix data
                    document.getElementById('matrix-size').value = size; // Set matrix size
                    updateMatrixInputs(); // Update input fields for new size
                    const inputs = document.querySelectorAll('#matrix-inputs input'); // Get all input fields
                    matrix.forEach((row, i) => {
                        row.forEach((value, j) => {
                            inputs[i * (size + 1) + j].value = value; // Set input values from saved matrix
                        });
                    });
                    showMessage(`Matrix "${name}" loaded successfully.`, 'success'); // Show success message
                } catch (e) {
                    showMessage('Failed to load matrix. Data might be corrupted.', 'error'); // Show error message if load fails
                }
            } else {
                showMessage(`No matrix found with the name "${name}".`, 'error'); // Show error if matrix not found
            }
        }

        // Function to display messages to the user
        function showMessage(text, type) {
            const messageEl = document.getElementById('message'); // Get message element
            messageEl.textContent = text; // Set message text
            messageEl.className = `message ${type}`; // Set message class (error or success)
            messageEl.style.display = 'block'; // Show message
            setTimeout(() => {
                messageEl.style.display = 'none'; // Hide message after 3 seconds
            }, 3000);
        }

        // Function to toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode'); // Toggle dark-mode class on body
        }

        // Initialize matrix inputs when page loads
        updateMatrixInputs();
    </script>
</body>
</html>